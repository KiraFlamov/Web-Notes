<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- для мобильных устройств -->
    <title>Заметки</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"> <!-- подключаем css -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}"> <!-- иконка -->
</head>

<body>
    <h1>Мои заметки</h1>

    <!-- Форма для уведомлений -->
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <div class="notification">{{ messages[0] | e }}</div>
            <script>
                const note = document.querySelector('.notification');
                if (note) {
                    note.classList.add('show'); // делаем видимым
                    setTimeout(() => {
                      note.classList.remove('show'); // <скрываем></скрываем>
                    }, 1500); // через 1.5 секунды
                }
            </script>
        {% endif %}
    {% endwith %}

    <div class="container">
        <div class="left-panel">

            <!-- Форма для поиска -->
            <h3>Найти заметку:</h3>
            <form action="{{ url_for('search') }}" method="get">
                <input type="text" id="search-input" name="query" placeholder="Поиск заметок..." value="{{ query }}" required>
                <!--<button type="button" onclick="document.getElementById('search-input').value = '';">Очистить</button>*-->
                <button type="submit" style="float: left";>Поиск</button>
            </form>
            <br>
            <br>

            <!-- Форма для добавления -->
            <h3>Добавить заметку:</h3>
            <form action="{{ url_for('add') }}" method="post">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <input type="text" name="title" placeholder="Заголовок" required>
                <textarea class="content-textarea" name="content" placeholder="Содержание" required></textarea>
                <button type="submit">Добавить</button>
            </form>
        </div>

        <div class="right-panel">

            <!-- При поиске: -->
            {% if search %}
                <h3>Результаты поиска для "{{ query }}"</h3>
                <p>Найдено заметок: {{ number_of_queries }}</p>
                <form action="{{ url_for('index') }}" method="get">
                    <button type="submit">Назад</button>
                </form>
            {% endif %}

            <!-- Список заметок -->
            {% if notes %}
            <div class="sort-toggle"> <!-- отображение при сортировке -->
                {% if search %}
                    {% if sort_order == "asc" %}
                        <a href="{{ url_for('search', query=query, sort='desc') }}">Сначала новые</a>
                    {% else %}
                        <a href="{{ url_for('search', query=query, sort='asc') }}">Сначала старые</a>
                    {% endif %}
                {% else %}
                    {% if sort_order == "asc" %}
                        <a href="{{ url_for('index', sort='desc') }}">Сначала новые</a>
                    {% else %}
                        <a href="{{ url_for('index', sort='asc') }}">Сначала старые</a>
                    {% endif %}
                {% endif %}
            </div>


                <div class="notes-list">
                    <ul>
                        {% for note in notes %}
                            <li>
                                <h3>{{ note.title }}</h3>
                                <p>{{ note.content }}</p>

                                <div class="note-footer">
                                    <small class="note-date">Создано: {{ note.created }} | Обновлено: {{ note.updated }}</small>
                                    <div class="note-buttons">
                                        <!-- Кнопка редактирования -->
                                        <form action="{{ url_for('edit', note_id=note.id) }}" method="get">
                                            <button type="submit">Изменить</button>
                                        </form>
                                        <!-- Кнопка удаления -->
                                        <form action="{{ url_for('delete', note_id=note.id) }}" method="post">
                                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                            <button type="submit" onclick="return confirm('Удалить заметку?')">Удалить</button>
                                        </form>
                                    </div>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% else %}
                {% if search %}
                    <!-- ничего не делаем -->
                {% else %}
                    <p>Заметок пока нет.</p>
                {% endif %}
            {% endif %}
        </div>
    </div>
    <a class="exit" href="{{ url_for('logout') }}">Выйти</a>
</body>
</html>
